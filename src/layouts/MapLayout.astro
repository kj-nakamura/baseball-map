---
import BaseLayout from './BaseLayout.astro';

export interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;

// ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ç’°å¢ƒå¤‰æ•°ã‚’å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ãï¼‰
const GOOGLE_MAPS_API_KEY = import.meta.env.VITE_GOOGLE_MAPS_API_KEY || 'AIzaSyBHS73Lg8QMhIWmuJEZ8mr_fC-J7aiEPfQ';
const OPENWEATHER_API_KEY = import.meta.env.VITE_OPENWEATHER_API_KEY || '3d403b187a1b8cba7d79fbed4a1d0562';
---

<BaseLayout title={title} description={description}>
  <div class="header">
    <h1>ãƒ—ãƒ­é‡çƒ12çƒå›£æœ¬æ‹ åœ°ãƒãƒƒãƒ—</h1>
    <p>æ—¥æœ¬ãƒ—ãƒ­é‡çƒ12çƒå›£ã®æœ¬æ‹ åœ°çƒå ´ã‚’åœ°å›³ä¸Šã§ç¢ºèªã§ãã¾ã™</p>
  </div>

  <div class="league-toggle">
    <button class="league-btn" onclick="showAllTeams()">å…¨çƒå ´</button>
    <button class="league-btn active" onclick="showMainTeams()">1è»ã®ã¿</button>
    <button class="league-btn" onclick="showFarmTeams()">ãƒ•ã‚¡ãƒ¼ãƒ ã®ã¿</button>
    <button class="league-btn regional" onclick="showRegionalStadiums()">åœ°æ–¹é–‹å‚¬</button>
  </div>
  
  <div class="league-toggle">
    <button class="league-btn central" onclick="showCentralLeague()">ã‚»ãƒ»ãƒªãƒ¼ã‚°</button>
    <button class="league-btn pacific" onclick="showPacificLeague()">ãƒ‘ãƒ»ãƒªãƒ¼ã‚°</button>
    <button class="league-btn eastern" onclick="showEasternLeague()">ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ³</button>
    <button class="league-btn western" onclick="showWesternLeague()">ã‚¦ã‚¨ã‚¹ã‚¿ãƒ³</button>
  </div>

  <div id="map"></div>

  <!-- ãƒªãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="section section--gradient section--rainbow-border">
    <div class="section__container section__container--narrow">
      <div class="heading">
        <h2 class="heading__title">âš¾ é‡çƒè¦³æˆ¦ã‚’ã‚‚ã£ã¨æ¥½ã—ã‚€</h2>
      </div>
      <div class="grid grid--responsive">
        <a href="/guides" class="card card--interactive card--vertical card--primary">
          <div class="card__header">
            <div class="card__icon card__icon--primary">ğŸŸï¸</div>
            <span class="badge badge--primary">è¦³æˆ¦ã‚¬ã‚¤ãƒ‰</span>
          </div>
          <div class="card__content">
            <h3 class="card__title">å…¨12çƒå›£è¦³æˆ¦ã‚¬ã‚¤ãƒ‰</h3>
            <p class="card__description">å„çƒå ´ã®è©³ç´°ãªè¦³æˆ¦æƒ…å ±ã€åº§å¸­ã€ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã€ã‚°ãƒ«ãƒ¡æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯</p>
          </div>
          <div class="card__footer">
            <span class="action-link">ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹ â†’</span>
          </div>
        </a>
        
        <a href="/travel" class="card card--interactive card--vertical card--secondary">
          <div class="card__header">
            <div class="card__icon card__icon--secondary">ğŸ—¾</div>
            <span class="badge badge--primary">æ—…è¡Œãƒ—ãƒ©ãƒ³</span>
          </div>
          <div class="card__content">
            <h3 class="card__title">ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ä¸€è¦§</h3>
            <p class="card__description">é‡çƒè¦³æˆ¦ã¨è¦³å…‰ã‚’çµ„ã¿åˆã‚ã›ãŸã€å……å®Ÿã®æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆ</p>
          </div>
          <div class="card__footer">
            <span class="action-link">ã‚³ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ â†’</span>
          </div>
        </a>
      </div>
    </div>
  </section>

  <div id="team-info" style="display: none;">
    <h2 id="team-name"></h2>
    <p><strong>çƒå ´:</strong> <span id="stadium-name"></span></p>
    <p><strong>æ‰€åœ¨åœ°:</strong> <span id="location"></span></p>
    <p><strong>ãƒªãƒ¼ã‚°:</strong> <span id="league"></span></p>
    <div id="weather-info"></div>
    <div style="margin-top: 1rem;">
      <a id="guide-link" href="#" style="display: inline-block; background: #3498db; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 5px;">ğŸ“– è¦³æˆ¦ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹</a>
    </div>
  </div>

  <script type="module" define:vars={{ GOOGLE_MAPS_API_KEY, OPENWEATHER_API_KEY }}>
    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’å—ã‘å–ã‚Š
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®šã—ã¦weather.jsã‹ã‚‰ã‚‚åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹
    window.GOOGLE_MAPS_API_KEY = GOOGLE_MAPS_API_KEY;
    window.OPENWEATHER_API_KEY = OPENWEATHER_API_KEY;

    // Google Maps APIã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
    function loadGoogleMapsAPI() {
      if (!GOOGLE_MAPS_API_KEY) {
        console.error('Google Maps API ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
        return;
      }
      
      const script = document.createElement('script');
      script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&callback=initMap&language=ja&region=JP`;
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
    }

    // script.jsã‹ã‚‰é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®š
    import('/src/scripts/script.js').then(module => {
      window.initMap = module.initMap;
      window.showAllTeams = module.showAllTeams;
      window.showMainTeams = module.showMainTeams;
      window.showFarmTeams = module.showFarmTeams;
      window.showRegionalStadiums = module.showRegionalStadiums;
      window.showCentralLeague = module.showCentralLeague;
      window.showPacificLeague = module.showPacificLeague;
      window.showEasternLeague = module.showEasternLeague;
      window.showWesternLeague = module.showWesternLeague;
      
      // Google Maps APIã‚’èª­ã¿è¾¼ã¿
      loadGoogleMapsAPI();
    });

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿
    document.addEventListener('DOMContentLoaded', () => {
      // script.jsã¯ä¸Šè¨˜ã®importã§å‡¦ç†ã•ã‚Œã‚‹ã®ã§ã€ã“ã“ã§ã¯ä½•ã‚‚ã—ãªã„
    });
    
    // å¤©æ°—æƒ…å ±çµ±åˆç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
    window.updateTeamWeatherInfo = async function(stadium) {
      const weatherInfoDiv = document.getElementById('weather-info');
      const guideLink = document.getElementById('guide-link');
      
      if (weatherInfoDiv) {
        weatherInfoDiv.innerHTML = '<div style="color: #666; font-size: 0.9rem;">å¤©æ°—æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
        
        try {
          // å¤©æ°—UIæ©Ÿèƒ½ã‚’å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
          const { createCompactWeatherInfo } = await import('/src/scripts/weather-ui.js');
          
          // ãƒ‰ãƒ¼ãƒ çƒå ´ã®åˆ¤å®š
          const isIndoor = stadium.stadium.includes('ãƒ‰ãƒ¼ãƒ ') || 
                         stadium.stadium.includes('ãƒ‰ãƒ¼ãƒ ') ||
                         stadium.stadium === 'æ±äº¬ãƒ‰ãƒ¼ãƒ ';
          
          const weatherHtml = await createCompactWeatherInfo(stadium, isIndoor);
          weatherInfoDiv.innerHTML = weatherHtml;
        } catch (error) {
          console.error('Weather info error:', error);
          weatherInfoDiv.innerHTML = '<div style="color: #999; font-size: 0.8rem;">å¤©æ°—æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ</div>';
        }
      }
      
      // è¦³æˆ¦ã‚¬ã‚¤ãƒ‰ãƒªãƒ³ã‚¯ã‚’æ›´æ–°
      if (guideLink && stadium.guideUrl) {
        guideLink.href = stadium.guideUrl;
        guideLink.style.display = 'inline-block';
      } else if (guideLink) {
        guideLink.style.display = 'none';
      }
    };
  </script>
</MapLayout>

<style>
  @import '/src/styles/design-tokens.css';
  @import '/src/styles/components.css';
  @import '/src/styles/utilities.css';
  @import '/src/styles/style.css';
  @import '/src/styles/weather.css';
</style>