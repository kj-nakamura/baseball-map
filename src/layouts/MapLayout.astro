---
import BaseLayout from './BaseLayout.astro';

export interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;

// ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ç’°å¢ƒå¤‰æ•°ã‚’å–å¾—
const OPENWEATHER_API_KEY = import.meta.env.VITE_OPENWEATHER_API_KEY;

// API ã‚­ãƒ¼ã®æ¤œè¨¼
if (!OPENWEATHER_API_KEY) {
  console.warn('OpenWeather API key is not configured');
}
---

<BaseLayout title={title} description={description}>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" slot="head" />
  
  <!-- Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" slot="head"></script>
  <div class="map-container">
    <div class="header">
    <h1>ãƒ—ãƒ­é‡çƒ12çƒå›£æœ¬æ‹ åœ°ãƒãƒƒãƒ—</h1>
    <p>æ—¥æœ¬ãƒ—ãƒ­é‡çƒ12çƒå›£ã®æœ¬æ‹ åœ°çƒå ´ã‚’åœ°å›³ä¸Šã§ç¢ºèªã§ãã¾ã™</p>
  </div>

  <div class="league-toggle">
    <button class="league-btn" onclick="showAllTeams()">å…¨çƒå ´</button>
    <button class="league-btn active" onclick="showMainTeams()">1è»ã®ã¿</button>
    <button class="league-btn" onclick="showFarmTeams()">ãƒ•ã‚¡ãƒ¼ãƒ ã®ã¿</button>
    <button class="league-btn regional" onclick="showRegionalStadiums()">åœ°æ–¹é–‹å‚¬</button>
  </div>
  
  <div class="league-toggle">
    <button class="league-btn central" onclick="showCentralLeague()">ã‚»ãƒ»ãƒªãƒ¼ã‚°</button>
    <button class="league-btn pacific" onclick="showPacificLeague()">ãƒ‘ãƒ»ãƒªãƒ¼ã‚°</button>
    <button class="league-btn eastern" onclick="showEasternLeague()">ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ³</button>
    <button class="league-btn western" onclick="showWesternLeague()">ã‚¦ã‚¨ã‚¹ã‚¿ãƒ³</button>
  </div>

  <div id="map"></div>
  
  <!-- çƒå›£ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
  <div id="team-list" class="team-list"></div>

  <!-- ãƒªãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="section section--gradient section--rainbow-border">
    <div class="section__container section__container--narrow">
      <div class="heading">
        <h2 class="heading__title">âš¾ é‡çƒè¦³æˆ¦ã‚’ã‚‚ã£ã¨æ¥½ã—ã‚€</h2>
      </div>
      <div class="grid grid--responsive">
        <a href="/guides" class="card card--interactive card--vertical card--primary">
          <div class="card__header">
            <div class="card__icon card__icon--primary">ğŸŸï¸</div>
            <span class="badge badge--primary">è¦³æˆ¦ã‚¬ã‚¤ãƒ‰</span>
          </div>
          <div class="card__content">
            <h3 class="card__title">å…¨12çƒå›£è¦³æˆ¦ã‚¬ã‚¤ãƒ‰</h3>
            <p class="card__description">å„çƒå ´ã®è©³ç´°ãªè¦³æˆ¦æƒ…å ±ã€åº§å¸­ã€ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã€ã‚°ãƒ«ãƒ¡æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯</p>
          </div>
          <div class="card__footer">
            <span class="action-link">ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹ â†’</span>
          </div>
        </a>
        
        <a href="/travel" class="card card--interactive card--vertical card--secondary">
          <div class="card__header">
            <div class="card__icon card__icon--secondary">ğŸ—¾</div>
            <span class="badge badge--primary">æ—…è¡Œãƒ—ãƒ©ãƒ³</span>
          </div>
          <div class="card__content">
            <h3 class="card__title">ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ä¸€è¦§</h3>
            <p class="card__description">é‡çƒè¦³æˆ¦ã¨è¦³å…‰ã‚’çµ„ã¿åˆã‚ã›ãŸã€å……å®Ÿã®æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆ</p>
          </div>
          <div class="card__footer">
            <span class="action-link">ã‚³ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ â†’</span>
          </div>
        </a>
        
        <a href="/ja/mlb" class="card card--interactive card--vertical card--accent">
          <div class="card__header">
            <div class="card__icon card__icon--accent">ğŸŒ</div>
            <span class="badge badge--accent">MLB</span>
          </div>
          <div class="card__content">
            <h3 class="card__title">MLBã‚¹ã‚¿ã‚¸ã‚¢ãƒ ãƒãƒƒãƒ—</h3>
            <p class="card__description">ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒªãƒ¼ã‚°ãƒ™ãƒ¼ã‚¹ãƒœãƒ¼ãƒ«å…¨30çƒå›£ã®ã‚¹ã‚¿ã‚¸ã‚¢ãƒ ã‚’åœ°å›³ä¸Šã§ç¢ºèª</p>
          </div>
          <div class="card__footer">
            <span class="action-link">MLBãƒãƒƒãƒ—ã‚’è¦‹ã‚‹ â†’</span>
          </div>
        </a>
      </div>
    </div>
  </section>

  <div id="team-info" style="display: none;">
    <h2 id="team-name"></h2>
    <p><strong>çƒå ´:</strong> <span id="stadium-name"></span></p>
    <p><strong>æ‰€åœ¨åœ°:</strong> <span id="location"></span></p>
    <p><strong>ãƒªãƒ¼ã‚°:</strong> <span id="league"></span></p>
    <div id="weather-info"></div>
    <div style="margin-top: 1rem;">
      <a id="guide-link" href="#" style="display: inline-block; background: #3498db; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 5px;">ğŸ“– è¦³æˆ¦ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹</a>
    </div>
  </div>

  <script type="module" define:vars={{ OPENWEATHER_API_KEY }}>
    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’å—ã‘å–ã‚Š
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®šã—ã¦weather.jsã‹ã‚‰ã‚‚åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹
    window.OPENWEATHER_API_KEY = OPENWEATHER_API_KEY;

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«Leafletãƒãƒƒãƒ—ã‚’åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // LeafletãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…ã¤
      const checkLeaflet = () => {
        if (typeof L !== 'undefined') {
          initMap();
        } else {
          setTimeout(checkLeaflet, 100);
        }
      };
      checkLeaflet();
    });
    
    // å¤©æ°—æƒ…å ±çµ±åˆç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
    window.updateTeamWeatherInfo = async function(stadium) {
      const weatherInfoDiv = document.getElementById('weather-info');
      const guideLink = document.getElementById('guide-link');
      
      if (weatherInfoDiv) {
        weatherInfoDiv.innerHTML = '<div style="color: #666; font-size: 0.9rem;">å¤©æ°—æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
        
        try {
          // å¤©æ°—UIæ©Ÿèƒ½ã‚’å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
          const { createCompactWeatherInfo } = await import('/src/scripts/weather-ui.js');
          
          // ãƒ‰ãƒ¼ãƒ çƒå ´ã®åˆ¤å®š
          const isIndoor = stadium.stadium.includes('ãƒ‰ãƒ¼ãƒ ') || 
                         stadium.stadium.includes('ãƒ‰ãƒ¼ãƒ ') ||
                         stadium.stadium === 'æ±äº¬ãƒ‰ãƒ¼ãƒ ';
          
          const weatherHtml = await createCompactWeatherInfo(stadium, isIndoor);
          weatherInfoDiv.innerHTML = weatherHtml;
        } catch (error) {
          console.error('Weather info error:', error);
          weatherInfoDiv.innerHTML = '<div style="color: #999; font-size: 0.8rem;">å¤©æ°—æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ</div>';
        }
      }
      
      // è¦³æˆ¦ã‚¬ã‚¤ãƒ‰ãƒªãƒ³ã‚¯ã‚’æ›´æ–°
      if (guideLink && stadium.guideUrl) {
        guideLink.href = stadium.guideUrl;
        guideLink.style.display = 'inline-block';
      } else if (guideLink) {
        guideLink.style.display = 'none';
      }
    };
  </script>
  </div>
</MapLayout>


<style>
  @import '/src/styles/design-tokens.css';
  @import '/src/styles/components.css';
  @import '/src/styles/utilities.css';
  @import '/src/styles/style.css';
  @import '/src/styles/weather.css';

  .map-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  /* Custom marker styles */
  .custom-marker {
    background: transparent !important;
    border: none !important;
  }

  /* Team list styling (similar to MLB) */
  .team-list {
    margin-top: 30px;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .team-list h3 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.5rem;
    text-align: center;
  }

  .table-container {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .teams-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    font-size: 14px;
  }

  .teams-table thead {
    background: #f1f3f4;
  }

  .teams-table th {
    padding: 12px 8px;
    text-align: left;
    font-weight: 600;
    color: #2c3e50;
    border-bottom: 2px solid #dee2e6;
  }

  .teams-table td {
    padding: 10px 8px;
    border-bottom: 1px solid #dee2e6;
    vertical-align: middle;
  }

  .team-row {
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .team-row:hover {
    background-color: #e3f2fd;
  }

  .team-row:nth-child(even) {
    background-color: #f8f9fa;
  }

  .team-row:nth-child(even):hover {
    background-color: #e3f2fd;
  }

  .logo-cell {
    text-align: center;
    width: 50px;
  }

  .team-logo-table {
    width: 28px;
    height: 28px;
    object-fit: contain;
    display: block;
    margin: 0 auto;
    border-radius: 4px;
  }

  .team-name-cell {
    font-weight: 600;
    color: #2c3e50;
  }

  .stadium-cell {
    color: #495057;
  }

  .location-cell {
    color: #6c757d;
  }

  .central-league-row {
    border-left: 4px solid #e74c3c;
  }

  .pacific-league-row {
    border-left: 4px solid #3498db;
  }

  @media (max-width: 768px) {
    .map-container {
      padding: 10px;
    }
    
    .team-list {
      padding: 15px;
    }
    
    .teams-table {
      font-size: 12px;
    }
    
    .teams-table th,
    .teams-table td {
      padding: 8px 6px;
    }
    
    .team-logo-table {
      width: 24px;
      height: 24px;
    }
  }

  @media (max-width: 480px) {
    .location-cell {
      display: none;
    }
    
    .teams-table th:nth-child(4) {
      display: none;
    }
  }
</style>

<script src="/src/scripts/script.js"></script>
<script src="/src/scripts/weather.js"></script>